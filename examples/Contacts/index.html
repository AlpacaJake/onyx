<!doctype html>
<html>
<head>
	<title>Contacts</title>
	<!-- -->
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="viewport" content="width=device-width initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<!-- -->
	<script src="../../../../enyo/enyo.js" type="text/javascript"></script>
	<script src="../../../../lib/layout/package.js" type="text/javascript"></script>
	<script src="../../../../lib/onyx/package.js" type="text/javascript"></script>
	<script src="../../../../lib/onyx/source/wip-package.js" type="text/javascript"></script>
	<!-- -->
	<script src="NameGenerator.js" type="text/javascript"></script>
	<!-- -->
	<style>
		body {
			color: white;
		}
		#app_list {
			background: url(images/bg.png);
		}
		
		.item {
			border-top: 1px solid silver;
			
		}
		
		.item-content.item-selected {
			background: #226B9A url(images/item-hilite.png) repeat-x bottom;
		}
		
		.item-content {
			padding: 12px 16px;
			background-color: #333333;
			/**/
			-webkit-box-sizing: border-box;
			-ms-box-sizing: border-box;
			-moz-box-sizing: border-box;
			box-sizing: border-box;
		}

		.item-content > * {
			display: inline-block;
			vertical-align: middle;
		}

		.avatar {
			padding-right: 10px;
		}
		.title {
			font-size: 12px;
			color: silver;
		}
		.divider {
			background-color: #666;
			font-size: 14px;
			font-weight: bold;
			padding: 8px 14px;
		}
		.remove-button {
			float: right;
			display: none;
		}
	</style>
</head>

<body>
	<script>
		var avatars = [
			"angel.png",
			"astrologer.png",
			"athlete.png",
			"baby.png",
			"clown.png",
			"devil.png",
			"doctor.png",
			"dude.png",
			"dude2.png",
			"dude3.png",
			"dude4.png",
			"dude5.png",
			"dude6.png"
		];
		var titles = [
			"Regional Data Producer",
			"Internal Markets Administrator",
			"Central Solutions Producer",
			"Dynamic Program Executive",
			"Direct Configuration Executive",
			"International Marketing Assistant",
			"District Research Consultant",
			"Lead Intranet Coordinator",
			"Central Accountability Director",
			"Product Web Assistant"
		];
		enyo.kind({
			name: "App",
			classes: "enyo-unselectable",
			kind: "FittableRows",
			components: [
				{kind: "onyx.Toolbar", components: [
					{kind: "onyx.InputDecorator", components: [
						{name: "rowsInput", kind: "onyx.Input", value: 200},
					]},
					{kind: "onyx.Button", content: "create contacts", ontap: "createList"},
					{kind: "onyx.InputDecorator", components: [
						{name: "nameInput", kind: "onyx.Input", value: "Frankie Fu"},
					]},
					{kind: "onyx.Button", content: "new contact", ontap: "addItem"},
					{kind: "onyx.Button", content: "remove selected", ontap: "removeSelected"}
				]},
				{name: "list", kind: "List", fit: true, multiSelect: true, onSetupRow: "setupItem", onSelect: "selectItem", components: [
					{name: "divider", showing: false, classes: "divider"},
					{name: "item", kind: "onyx.SwipeableItem", classes: "item", XtapHighlight: false, contentClasses: "item-content", onDelete: "removeTap", components: [
						{name: "avatar", kind: "Image", classes: "avatar"},
						{components: [
							{name: "name"},
							{name: "title", classes: "title"}
						]}
					]}
				]}
			],
			create: function() {
				this.inherited(arguments);
				var rows = this.$.list.rows = 200;
				this.createDb(rows);
			},
			setupItem: function(inSender, inEvent) {
				var i = inEvent.index;
				var item = this.db[i];
				// item
				this.$.name.setContent(item.name);
				this.$.avatar.setSrc(item.avatar);
				this.$.title.setContent(item.title);
				this.$.item.applyContentStyle("height", item.height + "px");
				// selection
				this.$.item.addRemoveContentClass("item-selected", this.isSelected(i));
				// divider
				var d = item.name[0];
				var prev = this.db[i-1];
				var showd = d != (prev && prev.name[0]);
				this.$.divider.setContent(d);
				this.$.divider.setShowing(showd);
				this.$.item.applyStyle("border-top", showd ? "none" : null);
			},
			createList: function() {
				this.createDb(this.$.rowsInput.getValue());
				this.$.list.setRows(this.db.length);
				this.$.list.reset();
			},
			createDb: function(inRows) {
				this.db = [];
				for (var i=0; i<inRows; i++) {
					this.db.push(this.generateItem(makeName(4, 6) + " " + makeName(5, 10)));
				}
				this.sortDb();
			},
			generateItem: function(inName) {
				return {
					name: inName,
					avatar: "images/avatars/" + avatars[enyo.irand(avatars.length)],
					title: titles[enyo.irand(titles.length)],
					//height: 70 + enyo.irand(10) * 4
					height: 110
				}
			},
			sortDb: function() {
				this.db.sort(function(a, b) {
					if (a.name < b.name) return -1;
					else if (a.name > b.name) return 1;
					else return 0;
				});
			},
			refreshList: function() {
				this.$.list.setRows(this.db.length);
				this.$.list.refresh();
			},
			addItem: function() {
				var item = this.generateItem(enyo.cap(this.$.nameInput.getValue()));
				for (var i=0, di; di=this.db[i]; i++) {
					if (di.name > item.name) {
						this.db.splice(i, 0, item);
						break;
					}
				}
				this.refreshList();
			},
			removeItem: function(inIndex) {
				this._removeItem(inIndex);
				this.refreshList();
			},
			_removeItem: function(inIndex) {
				this.db.splice(inIndex, 1);
				this.selection && this.selection.deselect(inIndex);
			},
			selectItem: function(inSender, inEvent) {
				this.selection = inEvent.originator;
				this.$.list.refresh();
			},
			removeTap: function(inSender, inEvent) {
				this.removeItem(inEvent.index);
				return true;
			},
			removeSelected: function() {
				for (var l=this.selection.getSelected(), i=l.length-1; i>=0; i--) {
					if (l[i]) {
						this._removeItem(i);
					}
				}
				this.refreshList();
			},
			isSelected: function(inIndex) {
				return this.selection && this.selection.isSelected(inIndex);
			}
		});
		new App({fit: true}).write();
	</script>
</body>
</html>